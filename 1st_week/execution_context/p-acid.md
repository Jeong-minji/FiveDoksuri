# 실행 컨텍스트

> 바쁜 사람들을 위한 면접 예상 질문 답변 한 줄 정리
>
> - ## 실행 컨텍스트(execution context)는 무엇인가요?

## 실행 컨텍스트의 정의

---

- **실행 컨텍스트**란 ECMAScript 스펙에 따르면 실행 컨텍스트를 **\*실행 가능한 코드**를 형상화하고 구분하는 추상적인 개념이라고 정의한다.
  > 일반적으로 실행 가능한 코드를 **전역 코드**와 **함수 내 코드**로 정의한다.
- 실행 컨텍스트는 **실행 가능한 코드가 실행되기 위해 필요한 환경**이라고 간단하게 말할 수 있다.
- 비유해서 **코드의 실행**이 **요리를 하는 것**이라고 말한다면, **실행 컨텍스트**는 **요리를 위해 준비한 재료들**이라고 말할 수 있을 것 같다!
- 자바스크립트 **코드가 실행되기 위해 필요한 것**들은 다음과 같다.

  - **변수** : 전역 변수, 지역 변수, 매개 변수, 객체의 프로퍼티
  - **함수 선언**
  - **변수의 유효 범위(Scope)**
  - **`this`**

- 코드가 실행되면 실행 컨텍스트 **\*스택(`stack`)** 이 생성되고 소멸된다.
  > **스택(`stack`)**: LIFO(Last In First Out, 후입 선출)의 나열 구조
- 보편적인 순서는 다음과 같이 진행된다.
  - 전역 코드로 컨트롤 진입 → 전역 실행 컨텍스트 생성 → 함수 코드로 컨트롤 이동 → 함수 실행 컨텍스트 생성(함수 내 함수까지 반복) → 함수 실행 → 함수 실행 컨텍스트 파기(소멸) → 직전의
    실행 컨텍스트에 컨트롤 반환

</br>

## 살행 컨텍스트의 구조(3가지 객체)

---

- 추상적인 개념의 실행 컨텍스트이지만, 물리적으로 객체의 형태를 가지며 다음의 3가지 프로퍼티를 소유한다.
  - **변수 객체(VO / Variable Object)**
  - **스코프 체인(SC / Scope Chain)**
  - **this value**

</br>

### 변수 객체(VO / Variable Object)

- 변수 객체는 **다른 객체들**을 가리키며 **변수, 함수, 매개변수(parameter) 및 인수 정보(arguments)** 등이 이에 해당한다.
- 변수 객체는 전역 컨텍스트의 경우 **전역 객체(GO)** 를 가리키고, 함수 컨텍스트의 경우 **활성 객체(AO)** 를 가리킨다.
- 활성 객체의 경우 `arguments object` 가 추가된다.

</br>

### 스코프 체인(SC / Scope Chain)

- 참조 가능한 변수, 선언 등의 정보를 갖는 **전역 객체(GO) 또는 활성 객체(AO)들의 리스트**이다.
  - 정확히 말하자면 변수를 검색하는 메커니즘이다. 변수가 아닌 객체 프로퍼티를 검색하는 메커니즘은 프로토타입 체인(Prototype Chain)이다.
  - 스코프 체인을 통해 렉시컬 스코프를 파악한다.
- 리스트는 **현재 실행 중인 컨텍스트 → 전역 컨텍스트 순**으로 진행된다.
- 검색에 실패하면 Reference Error를 발생시킨다.

</br>

### this value

- this 값이 할당되며 이는 함수 호출 패턴에 의해 결정된다.

</br>
</br>

## 실행 컨텍스트 생성 과정

---

> 실행 컨텍스트 실행 과정부터는 [해당 링크](https://poiemaweb.com/js-execution-context)의 다이어그램을 함께 참조하며 공부하시면 더 도움이 많이 됩니다.

### 전역 코드 진입

---

- 컨트롤이 실행 컨텍스트 진입 전에 **전역 객체 생성(GO)**

  - 해당 객체의 프로퍼티는 코드 내 어디에서도 참조 가능
  - 초기 상태에는 **빌트인 객체(Math, String, Array), BOM, DOM** 등이 설정되어 있다.
    </br>

    > **빌트인 객체 그리고 BOM과 DOM** > </br>
    >
    > - 빌트인 객체(Built in Object): 자바스크립트 엔진에 내장되어 사용자의 환경에 상관 없이 즉시 사용할 수 있는 코드
    > - BOM(Brouser Object Model): 브라우저에 대한 내용을 담은 객체(뒤로가기, 북마크, 히스토리 등)
    > - DOM(Document Object Model): 페이지에 대한 정보를 객체화 하여 담은 정보

</br>

- 전역 객체 생성 이후, **전역 실행 컨텍스트를 실행 컨텍스트 스택에 추가.**
- 요약: 전역 객체 생성 → 전역 실행 컨텍스트 생성 및 추가
- 이후 이하의 처리가 실행된다.
  - 스코프 체인의 생성 및 초기화
  - Variable Instantiation(변수 객체화) 실행
  - this value 결정

</br>

1. 스코프 체인의 생성 및 초기화
   - 전역 코드(실행 컨텍스트)의 경우 전역 객체의 레퍼런스를 포함하는 리스트
   - 함수 코드의 경우 실행 중인 활성 객체(AO)를 기준으로 역순으로 전역 객체까지 리스트를 만든다.

</br>

2. Variable Instantiation(변수 객체화) 실행
   - 변수, 매개변수와 인수 정보(arguments), 함수 선언을 Variable Object에 추가하여 객체화 하는 과정
     - (Function Code인 경우) 매개변수(parameter)가 Variable Object의 프로퍼티로, 인수(argument)가 값으로 설정된다.
     - 대상 코드 내의 함수 선언(함수 표현식 제외)을 대상으로 함수명이 Variable Object의 프로퍼티로, 생성된 함수 객체가 값으로 설정된다.(함수 호이스팅)
     - 대상 코드 내의 변수 선언을 대상으로 변수명이 Variable Object의 프로퍼티로, undefined가 값으로 설정된다.(변수 호이스팅)

</br>

3. this value 결정
   - this value가 결정되기 이전엔, 전역 객체를 가리키다가, 함수 호출 패턴에 의해 this에 할당되는 값이 결정된다.
   - 전역 코드의 경우 this는 전역 객체(브라우저의 경우 `Window`)를 가리킨다.

</br>

### 전역 코드 실행

---

- 코드 실행 환경을 위한 사전 준비를 진행했고, 이제 코드 실행이다.

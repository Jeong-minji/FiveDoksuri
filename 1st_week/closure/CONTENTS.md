# 클로저란(closure)

`클로저는 내부함수가 외부함수의 맥락(context)에 접근할 수 있는 것을 가르킨다. 클로저는 자바스크립트를 이용한 고난이도의 테크닉을 구사하는데 필수적인 개념으로 활용된다.`

그리고 MDN에서는
`클로저는 함수와 그 함수가 선언됐을 때의 렉시컬 환경(Lexical environment)과의 조합이다.`
이라고 클로저를 정의하고 있는데, 이를 이해하기 위해선

1. 무엇을 클로저라 부르는가?
2. 렉시컬 환경이란 무엇인가?

위 두 내용을 알아야만 합니다!

그럼 알아보도록 하죠.

---

## 1. 무엇을 클로저라 부르는가?

클로저는 함수의 내부에 선언된 함수(내부 함수)가 리턴되는 형태에서
`리턴되는 내부함수`를 말합니다.

## 2. 렉시컬 환경이란 무엇인가?

`Lexical Environment(렉시컬 환경)`은 특정 코드가 선언된 환경을 의미하며 모든 함
수, 코드 블록 {}, 스크립트는 렉시컬 환경을 가집니다.

### 근데.. 렉시컬 환경은 어디에 사용되나요?

사실 렉시컬 환경은 우리가 알지 못하게 항상 사용되고 있습니다.

혹시 `스코프`라는 개념을 아시나요?

`스코프`는 변수를 사용할 수 있는 범위인데, 이를 결정하는 것이 `렉시컬 환경` 입니
다!

때문에 `렉시컬 환경`을 통해 사용 가능한 변수가 달라지며, 이를
`Lexical scoping(렉시컬 스코핑)`이라고 합니다.

---

그럼 이제 다시 클로저의 정의를 보고 해석해봅시다.

`클로저는 함수와 그 함수가 선언됐을 때의 렉시컬 환경(Lexical environment)과의 조합이다.`

여기서 함수는 `내부함수`를 말하며, 렉시컬 환경과의 조합은 선언 당시의 스코프를말
하는 것이므로 `클로저는 내부함수가 선언됐을 때의 스코프를 기억하는 것(함수)`이라
고 말할 수 있습니다.

그럼 한 번 예시로 알아봅시다.

```js
// 예시
외부함수() {
    let text = "실행";
    return 내부함수() { console.log(text); }
}

let 변수 = 외부함수();
변수(); // "실행"
```

예시를 보면 `let 변수 = 외부함수()` 부분에서 외부함수는 내부함수를 반환하고 생을
마감했지만 `변수()`의 값엔 외부함수의 `text`변수 값이 있습니다.

이게 바로 `클로저`입니다. ~_this is closure_~

## 실행 컨텍스트 관점으로 클로저 이해하기

앞에서 클로저의 개념에 대해 간단하게 알아보았습니다.

이 파트에선 `실행 컨텍스트의 관점`으로 클로저를 이해해봅시다.

전에 나왔던 예시를 통해 알아보도록 하죠.

```js
// 예시
외부함수() {
    let text = "실행";
    return 내부함수() { console.log(text); }
}

let 변수 = 외부함수();
변수(); // "실행"
```

함수를 선언하면서 스코프가 결정됐습니다. 그리고 함수가 호출되면 자신의 실행 컨텍
스트가 스택에 쌓이며 변수 객체(Variable Object. VO)와 스코프 체인(Scope chain.
SC) 그리고 this에 바인딩할 객체가 결정됩니다.

이 때 스코프 체인은 상위 스코프(전역 스코프를 담은 전역 객체. GO)부터 자신의 스
코프를가진 활성 객체(Activation object. AO)까지 순차적으로 바인딩합니다.

여기서 중요한 점은 `내부함수가 유효한 이상 외부 함수의 활성 객체는 유효하다`라는
것입니다.

때문에 스코프 체인을통해 `let 변수 = 외부함수()` 부분에서 외부 함수의 실행 컨텍
스트가 스택에서 소멸하였어도 이후에 실행된 `변수()`에 외부함수의 text 값이
console에 찍힐수 있는 것 입니다.
